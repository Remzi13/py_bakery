<div id="product-modal" class="modal show" role="dialog" aria-modal="true">
    <div class="modal-content large-modal">
        <button class="close" onclick="document.getElementById('product-modal').remove()">&times;</button>
        <h2>{% if product %}Edit Product{% else %}Add Product{% endif %}</h2>
        <form {% if product %}hx-put="/api/products/{{ product.id }}" {% else %}hx-post="/api/products" {% endif %}
            hx-target="#products-table-body" hx-swap="beforeend" {% if product %} hx-swap="outerHTML"
            hx-target="#product-row-{{ product.id }}" {% endif %}
            hx-on::after-request="if(event.detail.successful) document.getElementById('product-modal').remove()">

            <div class="form-row">
                <div class="form-group">
                    <label for="product-name">Product Name</label>
                    <input id="product-name" type="text" name="name" value="{{ product.name if product else '' }}"
                        placeholder="e.g., Sourdough Loaf" required>
                </div>
                <div class="form-group small">
                    <label for="product-price">Price (â‚½)</label>
                    <input id="product-price" type="number" name="price" value="{{ product.price if product else '' }}"
                        placeholder="0" step="1" required>
                </div>
            </div>

            <!-- TODO: Handle dynamic materials list editing with HTMX -->
            <!-- For now, simplifying or we might need a separate endpoint for material rows -->
            <fieldset>
                <legend>Recipe (Materials)</legend>
                <p style="font-size: 0.8rem; color: orange;">Recipe editing not fully ported yet</p>
            </fieldset>

            <div class="form-actions">
                <button type="button" class="btn-secondary"
                    onclick="document.getElementById('product-modal').remove()">Cancel</button>
                <button type="submit" class="btn-primary">Save Product</button>
            </div>
        </form>
    </div>
</div>